# 用户使用教程

面向终端用户与运营人员，覆盖登录、地图、POS 管理、收藏/历史、品牌与权限、MCP 设置等核心流程。

## 1. 登录与语言
- 支持 Google / GitHub / Microsoft / LinuxDO OAuth，一键登录。
- 自动检测浏览器语言；可在右上角切换中/英/俄/德，偏好会本地保存。
- 首次登录可进入引导（Onboarding），包含快捷功能入口。

## 2. 地图与搜索
- 入口：`/app/map`（默认从 `/app` 跳转）。
- **定位**：点击定位按钮获取当前位置，地图自动居中。
- **搜索**：在顶部搜索框输入商户名/地址/收单行/坐标（如 `lat:31.2,lng:121.5`）。按回车或点击搜索按钮触发。
- **筛选**：可按支付方式（Apple Pay/Google Pay/闪付/HCE）、卡组织（Visa/Mastercard/银联/Amex/JCB 等）、验证模式（免密/PIN/签名）、收单机构、POS 型号、状态、评分、距离、有无备注/评价、创建时间等过滤。
- **查看详情**：点击地图标记或列表项进入 POS 详情页。
- **标记标签开关**：右上角可切换是否显示地图标记文字，适合密集区域浏览。

## 3. 列表模式
- 入口：`/app/list`，显示可排序/筛选的 POS 列表。
- 可与地图同样的筛选条件组合使用；支持排序和分页（若已实现）。

## 4. POS 管理
- **添加**：`/app/add-pos` 或在地图双击位置快速带入坐标。填写基础信息、支持的支付方式、卡组织、验证模式、手续费、备注等；提交后即时写入 Supabase。
- **编辑**：`/app/edit-pos/:id`，需具备编辑权限；支持更新基础信息与扩展字段。
- **删除**：在详情页或列表操作；需管理员/有权限用户确认。
- **我的 POS**：`/app/my-pos` 查看自己创建的设备；草稿保存在 `/app/drafts`。

## 5. 收藏、历史与通知
- **收藏**：详情页或列表点击“收藏”星标；在 `/app/favorites` 查看/取消。
- **历史记录**：`/app/history` 自动记录最近浏览与搜索。
- **通知**：`/app/notifications` 接收系统消息（如审核、权限变更、Beta 激活等）。

## 6. 品牌与角色
- **品牌管理**：`/app/brands` 可按 14 类品牌查看与筛选。
- **权限与角色**：`/app/role-management` 管理用户角色（regular/beta/admin/super_admin），控制编辑、删除、审核等能力。
- **Beta 激活**：在个人资料或设置中输入激活码，解锁 Beta 功能。

## 7. 个人资料与设置
- **资料**：`/app/profile` 查看账户信息、第三方绑定、MCP 设置入口。
- **设置**：`/app/settings` 包含语言、主题、通知偏好等。
- **帮助中心**：`/app/help` 查看常见问题与操作指引。

## 8. MCP 设置（Claude / CherryStudio）
- 入口：`/app/mcp-settings`（个人信息页快捷按钮）。
- 功能：生成 Claude Desktop/CherryStudio 配置、一键复制、查看已连接客户端列表、权限说明。
- 若生成配置时报缺表/函数，需在 Supabase 执行 `sql/mcp_sessions.sql`（详见 [MCP 集成与测试](./MCP-Integration.md)）。

## 9. 常见操作示例
- **快速添加带坐标的 POS**：在地图双击 → 自动带入经纬度 → 填表提交。
- **外卡友好商户筛选**：筛选 Visa/Mastercard + 支持闪付/Apple Pay/Google Pay + 支持 DCC（如需）。
- **查找特定收单行设备**：搜索框输入收单行或在筛选中填写 “acquiring institution”。
- **按评分/距离优先**：在筛选中设置最低评分或最大距离（需定位权限）。

## 10. 故障排查速览
- 登录失败：检查 OAuth 回调域名；浏览器第三方 Cookie 未禁用；Supabase Auth 未关闭。
- 地图空白：高德 Key 或安全域名未配置；网络被拦截；请刷新重试。
- 数据不显示：确认已运行最新迁移且 RLS 策略允许 anon（或使用服务端 key）。
- MCP 生成失败：确认数据库已创建 `mcp_sessions` 表和函数；服务端可访问。
